---
title: "ISIPs"
author: "Loay Jabre"
date: "July 23, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r message=FALSE, warning=FALSE, include=FALSE, results='hide'}

library(shiny)
library(ggplot2)
library(dplyr)
library(plyr)
library(gplots)
library(heatmap.plus)
library(RColorBrewer)
library(reshape2)
library(scales)
library(calibrate)
library(tidyr)
library(plotly)
library(scatterplot3d)
library(rgl)
library(gsubfn)
library(ggrepel)
library(gridExtra)
library(htmlwidgets)

source("fragtranscript_functions.R")

#Functions
## The function below allows me to select and plot one specific ISIP (name from the MCL data) and plot it. Then after that, I can put those plots on one page.
MCLclusterplot <- function(whichISIP, graphtitle){
ISIPMCL <- dplyr::filter(MCL, grepl (whichISIP, name))
ISIPMCL <- ISIPMCL [c(76, 1:75)]
ISIPMCL <- ISIPMCL [-c(2:28, 47:76)]
names(ISIPMCL)<- c("name", "A_0.5", "B_0.5", "C_0.5", "A_Fe_0.5", "B_Fe_0.5", "C_Fe_0.5", "A_3", "B_3", "C_3", "A_Fe_3", "B_Fe_3", "C_Fe_3","A_6", "B_6", "C_6", "A_Fe_6", "B_Fe_6", "C_Fe_6")

colname <- "mean"
i=0
while (i < 6){
colname <- paste(colname, i)
col1 = 2+(i*3)
col2 = 4+(i*3)
ISIPMCL[[colname]] <- rowMeans( ISIPMCL[, c(col1:col2)] )
i <- i+1
}

colname <- "SD"
i=0
while (i < 6){
colname <- paste(colname, i)
col1 = 2+(i*3)
col2 = 4+(i*3)
ISIPMCL[[colname]] <- apply ( ISIPMCL[, c(col1:col2)],1, sd )
i <- i+1
}

ISIPMCL <- ISIPMCL [-c(2:19)]
names(ISIPMCL) <- c("name","mean_NoFe_0.5", "mean_Fe_0.5", "mean_NoFe_3", "mean_Fe_3", "mean_NoFe_6", "mean_Fe_6","SD_NoFe_0.5", "SD_Fe_0.5", "SD_NoFe_3", "SD_Fe_3", "SD_NoFe_6", "SD_Fe_6")

ISIPMCL <-  melt (data = ISIPMCL,id.vars = "name")
ISIPMCL <- separate(ISIPMCL, col = variable, into = c("Statistic", "Fe", "temperature"))
ISIPMCL <- spread(ISIPMCL, Statistic, value)

ggplot(ISIPMCL, aes(x=temperature, y=mean, colour = Fe ))+
  geom_errorbar(aes(ymin = mean-SD, ymax = mean+SD), width = 0.5,   color = "black", size = 0.7)+
geom_point(size = 3)+
 geom_line(size = 1, aes (x=temperature, y=mean, group = interaction(Fe, name)))+
  scale_color_manual(values = c("red", "black"))+
xlab ("Temperature (°C)")+
  ylab ("Expression-Value")+
ggtitle(graphtitle)+
theme_bw()+
#labs (color = "Treatment") +
theme(plot.title = element_text(hjust = 0.5))+
theme(axis.text.x = element_text(angle = 50, vjust = 1.0, hjust = 1.0))
#guides(colour = "Treatment")
}

```

Import Datasets
```{r message=FALSE, warning=FALSE, include=FALSE}
ORF <- read.csv("ORF.csv", header = TRUE, sep = ",")
ORF$name <- paste(ORF$orf_id, ORF$cluster, ORF$kegg_desc, ORF$KO_desc, ORF$KO_pathway, ORF$KOG_desc, ORF$KOG_class, ORF$best_hit_annotation, ORF$PFams_desc, ORF$TIGRFams_desc)

MCL <- read.csv("MCL.csv", header = TRUE, sep = "," )
MCL$name <- paste (MCL$cluster, MCL$ann_desc)
```

#MCL volcano
```{r}
#volcanoplotinteractive <- function(Dataset, Fold, FDR, volcanontitle)
volcanoplotinteractive(MCL, "X12_vs_14.log2fc", "X12_vs_14.fdr", "Temp Test: 0C_VS_3C") 
volcanoplotinteractive(MCL, "X12_vs_16.log2fc", "X12_vs_16.fdr", "Temp Test: 0C_VS_6C") 
volcanoplotinteractive(MCL, "X14_vs_16.log2fc", "X14_vs_16.fdr", "Temp Test: 3C_VS_6C")
volcanoplotinteractive(MCL, "X12_vs_13.log2fc", "X12_vs_13.fdr", "Fe Test: 0C_VS_Fe0C")
volcanoplotinteractive(MCL, "X14_vs_15.log2fc", "X14_vs_15.fdr", "Fe Test: 3C_VS_Fe3C")
volcanoplotinteractive(MCL, "X16_vs_17.log2fc", "X16_vs_17.fdr", "Fe Test: 6C_VS_Fe6C")
volcanoplotinteractive(MCL, "X12_vs_15.log2fc", "X12_vs_15.fdr", "Synergy Test: 0C_VS_Fe3C")
volcanoplotinteractive(MCL, "X12_vs_17.log2fc", "X12_vs_17.fdr", "Synergy Test: 0C_VS_Fe6C")
```
 
# ORF volcano for ISIP ISIP  
```{r echo=FALSE, message=FALSE, warning=FALSE}
ISIP <- dplyr::filter (ORF, grepl('ISIP|isip', name))

#volcanoplotinteractive <- function(Dataset, Fold, FDR, volcanontitle)
volcanoplotinteractive(ISIP, "X12_vs_14.log2fc", "X12_vs_14.fdr", "Temp Test: 0C_VS_3C")    
volcanoplotinteractive(ISIP, "X12_vs_16.log2fc", "X12_vs_16.fdr", "Temp Test: 0C_VS_6C")     
volcanoplotinteractive(ISIP, "X14_vs_16.log2fc", "X14_vs_16.fdr", "Temp Test: 3C_VS_6C")
volcanoplotinteractive(ISIP, "X12_vs_13.log2fc", "X12_vs_13.fdr", "Fe Test: 0C_VS_Fe0C")
volcanoplotinteractive(ISIP, "X14_vs_15.log2fc", "X14_vs_15.fdr", "Fe Test: 3C_VS_Fe3C")
volcanoplotinteractive(ISIP, "X16_vs_17.log2fc", "X16_vs_17.fdr", "Fe Test: 6C_VS_Fe6C")
volcanoplotinteractive(ISIP, "X12_vs_15.log2fc", "X12_vs_15.fdr", "Synergy Test: 0C_VS_Fe3C")
volcanoplotinteractive(ISIP, "X12_vs_17.log2fc", "X12_vs_17.fdr", "Synergy Test: 0C_VS_Fe6C")
```

#MCL cluster ISIP plots 
```{r}
I1 <- MCLclusterplot('clust_1814 ', "ISIP1 - cluster 1814")
I2 <- MCLclusterplot('clust_9740 ', "ISIP2A - cluster 9740")
I3 <- MCLclusterplot('clust_1154 ', "ISIP3 - cluster 1154")
I4 <- MCLclusterplot('clust_25598 ', "ISIP2A - cluster 25598 (not significant)")
grid.arrange(I1, I2, I3, I4, nrow=2, ncol=2)
```


# ORF volcano for LHC
```{r}
LHC <- dplyr::filter (ORF, grepl('LHC|lhc|Lhc', name))
volcanoplotinteractive(LHC, "X12_vs_14.log2fc", "X12_vs_14.fdr", "Temp Test: 0C_VS_3C")    
volcanoplotinteractive(LHC, "X12_vs_16.log2fc", "X12_vs_16.fdr", "Temp Test: 0C_VS_6C")     
volcanoplotinteractive(LHC, "X14_vs_16.log2fc", "X14_vs_16.fdr", "Temp Test: 3C_VS_6C")
volcanoplotinteractive(LHC, "X12_vs_13.log2fc", "X12_vs_13.fdr", "Fe Test: 0C_VS_Fe0C")
volcanoplotinteractive(LHC, "X14_vs_15.log2fc", "X14_vs_15.fdr", "Fe Test: 3C_VS_Fe3C")
volcanoplotinteractive(LHC, "X16_vs_17.log2fc", "X16_vs_17.fdr", "Fe Test: 6C_VS_Fe6C")
volcanoplotinteractive(LHC, "X12_vs_15.log2fc", "X12_vs_15.fdr", "Synergy Test: 0C_VS_Fe3C")
volcanoplotinteractive(LHC, "X12_vs_17.log2fc", "X12_vs_17.fdr", "Synergy Test: 0C_VS_Fe6C")
```

#Light Harvesting Complexes
```{r}
F1 <- MCLclusterplot('clust_1236 ', "LHCf1 - cluster 1236")
F2 <- MCLclusterplot('clust_1194 ', "LHCf4 - cluster 1194")
grid.arrange(F1, F2, nrow=2, ncol=1)

X1 <- MCLclusterplot('clust_712 ', "LHCx1 - cluster 712")
X2 <- MCLclusterplot('clust_960 ', "LHCx5 - cluster 960")
X3 <- MCLclusterplot('clust_1787 ', "LHCx6 - cluster 1787")
grid.arrange(X1, X2, X3, nrow=2, ncol=2)

MCLclusterplot('clust_1550 ', "PSII Cytb559 - cluster 1550")

MCLclusterplot('clust_38070 ', "Chl A/B binding - 38070")
MCLclusterplot('clust_646 ', "Chl A/B binding - 646")
MCLclusterplot('clust_195 ', "Chl A/B binding - 195")
```



# ORF volcano for core antenna
```{r}
LHC <- dplyr::filter (ORF, grepl('A-B', name))
#LHC <- dplyr::filter (MCL, grepl('Photosystem|photosystem', name))


volcanoplotinteractive(LHC, "X12_vs_14.log2fc", "X12_vs_14.fdr", "Temp Test: 0C_VS_3C")    
volcanoplotinteractive(LHC, "X12_vs_16.log2fc", "X12_vs_16.fdr", "Temp Test: 0C_VS_6C")     
volcanoplotinteractive(LHC, "X14_vs_16.log2fc", "X14_vs_16.fdr", "Temp Test: 3C_VS_6C")
volcanoplotinteractive(LHC, "X12_vs_13.log2fc", "X12_vs_13.fdr", "Fe Test: 0C_VS_Fe0C")
volcanoplotinteractive(LHC, "X14_vs_15.log2fc", "X14_vs_15.fdr", "Fe Test: 3C_VS_Fe3C")
volcanoplotinteractive(LHC, "X16_vs_17.log2fc", "X16_vs_17.fdr", "Fe Test: 6C_VS_Fe6C")
volcanoplotinteractive(LHC, "X12_vs_15.log2fc", "X12_vs_15.fdr", "Synergy Test: 0C_VS_Fe3C")
volcanoplotinteractive(LHC, "X12_vs_17.log2fc", "X12_vs_17.fdr", "Synergy Test: 0C_VS_Fe6C")
```























```{r}
ISIP <- dplyr::filter (ORF, grepl('clust_7576', name))
ISIP1 <- ISIP [-c(1:46,50:64, 83:106)]
ISIP1 <- ISIP1 [c(22, 1:21)]
names(ISIP1)<- c("name", "A_T0", "B_T0", "C_T0", "A_0.5", "B_0.5", "C_0.5", "A_Fe_0.5", "B_Fe_0.5", "C_Fe_0.5", "A_3", "B_3", "C_3", "A_Fe_3", "B_Fe_3", "C_Fe_3","A_6", "B_6", "C_6", "A_Fe_6", "B_Fe_6", "C_Fe_6")

ISIP1  <- dplyr::filter (ISIP1, grepl('_75', name))

#this loops takes the means of the triplicate treatments
colname <- "mean"
i=0
while (i < 7){
colname <- paste(colname, i)
col1 = 2+(i*3)
col2 = 4+(i*3)
ISIP1[[colname]] <- rowMeans( ISIP1[, c(col1:col2)] )
i <- i+1
}

ISIP1<- ISIP1 [-c(2:23)]

names(ISIP1) <- c("name","NoFe_0.5", "Fe_0.5", "NoFe_3", "Fe_3", "NoFe_6", "Fe_6" )

ISIP1 <-  melt (data = ISIP1,id.vars = "name", measure.vars = c(2:7))
ISIP1 <- separate(ISIP1, col = variable, into = c("Fe", "temperature"))
ggplot(ISIP1, aes(x=temperature, y=value, colour = name, shape = Fe ))+
#geom_point(size = 2)+
#stat_summary(fun.y = mean, geom = "line", colour = "black", group =1, size = 1.25)+
#stat_summary(fun.data =  mean_se, geom = "errorbar", colour = "black")+
xlab ("Temperature (°C)")+
ylab ("Expression-Value")+
ggtitle("ISIP2A")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))+
theme(axis.text.x = element_text(angle = 50, vjust = 1.0, hjust = 1.0))+
guides(colour=FALSE)+
#scale_color_manual(name = "Treatment", labels = c("+Fe", "-Fe"), values = c("triangle", "square")) +
geom_jitter(width = 0.11, size =2)+
labs (shape = "Treatment")
#scale_y_log10()
#geom_line(aes(group=name))
```


This plots the raw triplicates 
```{r}
ISIPMCL <- dplyr::filter(MCL, grepl ('^clust_1814$', cluster))

ISIPMCL <- ISIPMCL [c(76, 1:75)]
ISIPMCL <- ISIPMCL [-c(2:28, 47:76)]
names(ISIPMCL)<- c("name", "A_NoFe_0.5", "B_NoFe_0.5", "C_NoFe_0.5", "A_Fe_0.5", "B_Fe_0.5", "C_Fe_0.5", "A_NoFe_3", "B_NoFe_3", "C_NoFe_3", "A_Fe_3", "B_Fe_3", "C_Fe_3","A_NoFe_6", "B_NoFe_6", "C_NoFe_6", "A_Fe_6", "B_Fe_6", "C_Fe_6")

ISIPMCL <-  melt (data = ISIPMCL,id.vars = "name")
ISIPMCL <- separate(ISIPMCL, col = variable, into = c("Rep", "Fe", "temperature"))

 ggplot(ISIPMCL, aes(x=temperature, y=value, colour = Fe, shape = Rep ))+
geom_point(size = 3)+
  scale_color_manual(values = c("red", "black"))+
xlab ("Temperature (°C)")+
ylab ("Expression-Value")+
#ggtitle("ISIP1")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))+
theme(axis.text.x = element_text(angle = 50, vjust = 1.0, hjust = 1.0))+
  scale_color_manual (name = "", labels = c("+Fe", "-Fe"), values = c("red", "black"))
```





