---
title: "ISIPs"
author: "Loay Jabre"
date: "July 23, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r message=FALSE, warning=FALSE, include=FALSE, results='hide'}

library(shiny)
library(ggplot2)
library(dplyr)
library(plyr)
library(gplots)
library(heatmap.plus)
library(RColorBrewer)
library(reshape2)
library(scales)
library(calibrate)
library(tidyr)
library(plotly)
library(scatterplot3d)
library(rgl)
library(gsubfn)
library(ggrepel)
library(gridExtra)
library(htmlwidgets)

source("fragtranscript_functions.R")

#Used functions: 
#MCLclusterplot <- function(whichdata, whichprotein, graphtitle): This plots the mean of the three triplicates in a line, against the three temperatures with -/+ Fe in two different colors. 

#MCLclusterrawplot <- function(whichdata, whichprotein, graphtitle): This plots the three points of the three triplicates (not the mean), against the three temperatures with -/+ Fe in two different colors. 
```

Import Datasets and make a name column in both 
```{r message=FALSE, warning=FALSE, include=FALSE}
ORF <- read.csv("ORF.csv", header = TRUE, sep = ",")
ORF$name <- paste(ORF$orf_id, ORF$cluster, ORF$kegg_desc, ORF$KO_desc, ORF$KO_pathway, ORF$KOG_desc, ORF$KOG_class, ORF$best_hit_annotation, ORF$PFams_desc, ORF$TIGRFams_desc)

MCL <- read.csv("MCL.csv", header = TRUE, sep = "," )
MCL$name <- paste (MCL$cluster, MCL$ann_desc)


allMCL <- read.csv("allMCL.csv", header = TRUE, sep = "," )
allMCL$name <- paste (allMCL$cluster, allMCL$ann_desc)

FragMCL <- dplyr::filter (allMCL, grepl('Fragilariopsis', Taxa.group))
PNitMCL <- dplyr::filter (allMCL, grepl('Pseudo-nit', Taxa.group))

all <- read.csv("all.csv", header = TRUE, sep = "," )
all$name <- paste(all$orf_id, all$cluster, all$kegg_desc, all$KO_desc, all$KO_pathway, all$KOG_desc, all$KOG_class, all$best_hit_annotation, all$PFams_desc, all$TIGRFams_desc)
Pseudo <- dplyr::filter (all, grepl('Pseudo-nitzschi', grpnorm_taxgrp))
Pseudo <- dplyr::filter (Pseudo, grepl('Eukar', domain))
```


# ORF volcano plot for Frag ISIPs   
```{r echo=FALSE, message=FALSE, warning=FALSE}
ISIP <- dplyr::filter (ORF, grepl('ISIP|isip', name))

#nitratereductase <- dplyr::filter (ORF, grepl('contig_580799_1_929_-|contig_1148680_114_1091_+|contig_1148680_1151_2203_+|contig_1155130_1_1036_+|contig_667814_1_947_-', orf_id))

#volcanoplotinteractive <- function(Dataset, Fold, FDR, volcanontitle)
volcanoplotinteractive(ISIP, "X12_vs_14.log2fc", "X12_vs_14.fdr", "Temp Test: 0C_VS_3C")    
volcanoplotinteractive(ISIP, "X12_vs_16.log2fc", "X12_vs_16.fdr", "Temp Test: 0C_VS_6C")     
volcanoplotinteractive(ISIP, "X14_vs_16.log2fc", "X14_vs_16.fdr", "Temp Test: 3C_VS_6C")
volcanoplotinteractive(ISIP, "X12_vs_13.log2fc", "X12_vs_13.fdr", "Fe Test: 0C_VS_Fe0C")
volcanoplotinteractive(ISIP, "X14_vs_15.log2fc", "X14_vs_15.fdr", "Fe Test: 3C_VS_Fe3C")
volcanoplotinteractive(ISIP, "X16_vs_17.log2fc", "X16_vs_17.fdr", "Fe Test: 6C_VS_Fe6C")
volcanoplotinteractive(ISIP, "X12_vs_15.log2fc", "X12_vs_15.fdr", "Synergy Test: 0C_VS_Fe3C")
volcanoplotinteractive(ISIP, "X12_vs_17.log2fc", "X12_vs_17.fdr", "Synergy Test: 0C_VS_Fe6C")
```


#MCL volcano including all of the clusters (annotated or not) 
```{r}
#volcanoplotinteractive <- function(Dataset, Fold, FDR, volcanontitle)
FragMCL <- dplyr::filter (PNitMCL, grepl('clust_1814|clust_1154|clust_9740', name))



volcanoplotinteractive(FragMCL, "X12_vs_14.log2fc", "X12_vs_14.fdr", "Temp Test: 0C_VS_3C")
volcanoplotinteractive(FragMCL, "X12_vs_16.log2fc", "X12_vs_16.fdr", "Temp Test: 0C_VS_6C")
volcanoplotinteractive(FragMCL, "X14_vs_16.log2fc", "X14_vs_16.fdr", "Temp Test: 3C_VS_6C")
volcanoplotinteractive(FragMCL, "X12_vs_13.log2fc", "X12_vs_13.fdr", "Fe Test: 0C_VS_Fe0C")
volcanoplotinteractive(FragMCL, "X14_vs_15.log2fc", "X14_vs_15.fdr", "Fe Test: 3C_VS_Fe3C")
volcanoplotinteractive(FragMCL, "X16_vs_17.log2fc", "X16_vs_17.fdr", "Fe Test: 6C_VS_Fe6C")
volcanoplotinteractive(FragMCL, "X12_vs_15.log2fc", "X12_vs_15.fdr", "Synergy Test: 0C_VS_Fe3C")
volcanoplotinteractive(FragMCL, "X12_vs_17.log2fc", "X12_vs_17.fdr", "Synergy Test: 0C_VS_Fe6C")
```
 

# ISIP plots for frag 
```{r}
#I1 <-
I1f<- MCLclusterrawplot (FragMCL, '^clust_1814$', "ISIP1 - cluster 1814Frag")
I1p<- MCLclusterrawplot (PNitMCL, '^clust_1814$', "ISIP1 - cluster 1814Pseudo")
I2f <- MCLclusterrawplot (FragMCL,'clust_9740', "ISIP2A - cluster 9740Frag")
I2p <- MCLclusterrawplot (PNitMCL,'clust_9740', "ISIP2A - cluster 9740Pseudo")
I3f <- MCLclusterrawplot (FragMCL,'clust_1154', "ISIP3 - cluster 1154Frag")
I3p <- MCLclusterrawplot (PNitMCL,'clust_1154', "ISIP3 - cluster 1154Pseudo")
#I4 <- MCLclusterrawplot (MCL,'clust_25598', "ISIP2A - cluster 25598 (not significant)")
grid.arrange(I1f,I1p,I2f,I2p, I3f, I3p, nrow=3, ncol=2)
```

# MCL cluster Nitrogen plots for for Frag
```{r}
NiR <- MCLclusterrawplot(MCL, '^clust_411$', "Nitrate reductase - cluster 411")
NitTrans <- MCLclusterrawplot(MCL, '^clust_991$', "Nitrate transporter portein - cluster 991")
NR <- MCLclusterrawplot(MCL, '^clust_3563$', "Nitrite reductase - cluster 3563")
Urease <- MCLclusterrawplot(MCL, '^clust_927$', "Urease - cluster 927")
URED <- MCLclusterrawplot(MCL, '^clust_20535$', "Urease Accessory Protein UreD - cluster 20535")
grid.arrange(NiR, NitTrans, NR, Urease, URED,  nrow=3, ncol=2)

GS<- MCLclusterrawplot(MCL, '^clust_589$', "Glutamine Synthetase - cluster 589")
GaS <- MCLclusterrawplot(MCL, '^clust_241$', "Glutamate Synthase - cluster 241")
grid.arrange(GS, GaS, nrow=1, ncol=2)

MCLclusterrawplot(MCL, '^clust_999$', "Nitrite reductase - cluster 3563")

LHC <- dplyr::filter (ORF, grepl('transaminase', name))

```



Pseudo
```{r}

Pseudo <- Pseudo [-c(2:4, 6,7, 10:12, 15:21, 23:26, 28, 30:34, 35:46,50:58, 83:106)]



Pseudo <- Pseudo [-c(1:9)]

Pseudo <- Pseudo [c(28, 1:27)]

ORF2$name <- sub('[.]', '_', make.names(ORF2$name, unique = TRUE))

names(Pseudo)<- c("name", "A_T0", "B_T0", "C_T0", "A_B12_0.5", "B_B12_0.5", "C_B12_0.5", "A_B12Fe_0.5", "B_B12Fe_0.5", "C_B12Fe_0.5", "A_0.5", "B_0.5", "C_0.5", "A_Fe_0.5", "B_Fe_0.5", "C_Fe_0.5", "A_3", "B_3", "C_3", "A_Fe_3", "B_Fe_3", "C_Fe_3","A_6", "B_6", "C_6", "A_Fe_6", "B_Fe_6", "C_Fe_6")



PISIP <- dplyr::filter (Pseudo, grepl('ISIP|isip', name))
PISIP <- PISIP [-c(5:10)]
heatmap(data, PISIP, "ISIP1")
xyplotconcise(PISIP,"All of ISIPs")



NiR <- MCLclusterrawplot(Pseudo, '^clust_411$', "Nitrate reductase - cluster 411")
NitTrans <- MCLclusterrawplot(Pseudo,'^clust_991$', "Nitrate transporter portein - cluster 991")
NR <- MCLclusterrawplot(Pseudo,'^clust_3563$', "Nitrite reductase - cluster 3563")
Urease <- MCLclusterrawplot(Pseudo,'^clust_927$', "Urease - cluster 927")
URED <- MCLclusterrawplot(Pseudo,'^clust_20535$', "Urease Accessory Protein UreD - cluster 20535")
grid.arrange(NiR, NitTrans, NR, Urease, URED,  nrow=3, ncol=2)

GS<- MCLclusterrawplot(Pseudo,'^clust_589$', "Glutamine Synthetase - cluster 589")
GaS <- MCLclusterrawplot(Pseudo,'^clust_241$', "Glutamate Synthase - cluster 241")
grid.arrange(GS, GaS, nrow=1, ncol=2)

MCLclusterrawplot(Pseduo,'^clust_1816$', "Nitrite reductase - cluster 3563")
LHC <- dplyr::filter (ORF, grepl('clust_1816', name))

```











# ORF volcano for LHC
```{r}
#LHC <- dplyr::filter (ORF, grepl('LHC|lhc|Lhc', name))

LHC <- dplyr::filter (ORF, grepl('ISIP', name))

volcanoplotinteractive(LHC, "X12_vs_14.log2fc", "X12_vs_14.fdr", "Temp Test: 0C_VS_3C")    
volcanoplotinteractive(LHC, "X12_vs_16.log2fc", "X12_vs_16.fdr", "Temp Test: 0C_VS_6C")     
volcanoplotinteractive(LHC, "X14_vs_16.log2fc", "X14_vs_16.fdr", "Temp Test: 3C_VS_6C")
volcanoplotinteractive(LHC, "X12_vs_13.log2fc", "X12_vs_13.fdr", "Fe Test: 0C_VS_Fe0C")
volcanoplotinteractive(LHC, "X14_vs_15.log2fc", "X14_vs_15.fdr", "Fe Test: 3C_VS_Fe3C")
volcanoplotinteractive(LHC, "X16_vs_17.log2fc", "X16_vs_17.fdr", "Fe Test: 6C_VS_Fe6C")
volcanoplotinteractive(LHC, "X12_vs_15.log2fc", "X12_vs_15.fdr", "Synergy Test: 0C_VS_Fe3C")
volcanoplotinteractive(LHC, "X12_vs_17.log2fc", "X12_vs_17.fdr", "Synergy Test: 0C_VS_Fe6C")
```


#Light Harvesting Complexes
```{r}
F1 <- MCLclusterrawplot('^clust_1236$', "LHCf1 - cluster 1236")
F2 <- MCLclusterrawplot('^clust_1194$', "LHCf4 - cluster 1194")
grid.arrange(F1, F2, nrow=2, ncol=1)

X1 <- MCLclusterrawplot('^clust_712$', "LHCx1 - cluster 712")
X2 <- MCLclusterrawplot('^clust_960$', "LHCx5 - cluster 960")
X3 <- MCLclusterrawplot('^clust_1787$', "LHCx6 - cluster 1787")
grid.arrange(X1, X2, X3, nrow=2, ncol=2)

MCLclusterplot('clust_1550 ', "PSII Cytb559 - cluster 1550")

MCLclusterplot('clust_38070 ', "Chl A/B binding - 38070")
MCLclusterplot('clust_646 ', "Chl A/B binding - 646")
MCLclusterplot('clust_195 ', "Chl A/B binding - 195")
MCLclusterplot('clust_534 ', "Flavodoxin - 534")

```



# ORF volcano for core antenna
```{r}
LHC <- dplyr::filter (ORF, grepl('nitrite', name))
#LHC <- dplyr::filter (MCL, grepl('Photosystem|photosystem', name))


volcanoplotinteractive(LHC, "X12_vs_14.log2fc", "X12_vs_14.fdr", "Temp Test: 0C_VS_3C")    
volcanoplotinteractive(LHC, "X12_vs_16.log2fc", "X12_vs_16.fdr", "Temp Test: 0C_VS_6C")     
volcanoplotinteractive(LHC, "X14_vs_16.log2fc", "X14_vs_16.fdr", "Temp Test: 3C_VS_6C")
volcanoplotinteractive(LHC, "X12_vs_13.log2fc", "X12_vs_13.fdr", "Fe Test: 0C_VS_Fe0C")
volcanoplotinteractive(LHC, "X14_vs_15.log2fc", "X14_vs_15.fdr", "Fe Test: 3C_VS_Fe3C")
volcanoplotinteractive(LHC, "X16_vs_17.log2fc", "X16_vs_17.fdr", "Fe Test: 6C_VS_Fe6C")
volcanoplotinteractive(LHC, "X12_vs_15.log2fc", "X12_vs_15.fdr", "Synergy Test: 0C_VS_Fe3C")
volcanoplotinteractive(LHC, "X12_vs_17.log2fc", "X12_vs_17.fdr", "Synergy Test: 0C_VS_Fe6C")
```




#All of ISIP2A in the ORF
```{r}
ISIP <- dplyr::filter (ORF, grepl('clust_7576', name))
ISIP1 <- ISIP [-c(1:46,50:64, 83:106)]
ISIP1 <- ISIP1 [c(22, 1:21)]
names(ISIP1)<- c("name", "A_T0", "B_T0", "C_T0", "A_0.5", "B_0.5", "C_0.5", "A_Fe_0.5", "B_Fe_0.5", "C_Fe_0.5", "A_3", "B_3", "C_3", "A_Fe_3", "B_Fe_3", "C_Fe_3","A_6", "B_6", "C_6", "A_Fe_6", "B_Fe_6", "C_Fe_6")

ISIP1  <- dplyr::filter (ISIP1, grepl('_75', name))

#this loops takes the means of the triplicate treatments
colname <- "mean"
i=0
while (i < 7){
colname <- paste(colname, i)
col1 = 2+(i*3)
col2 = 4+(i*3)
ISIP1[[colname]] <- rowMeans( ISIP1[, c(col1:col2)] )
i <- i+1
}

ISIP1<- ISIP1 [-c(2:23)]

names(ISIP1) <- c("name","NoFe_0.5", "Fe_0.5", "NoFe_3", "Fe_3", "NoFe_6", "Fe_6" )

ISIP1 <-  melt (data = ISIP1,id.vars = "name", measure.vars = c(2:7))
ISIP1 <- separate(ISIP1, col = variable, into = c("Fe", "temperature"))
ggplot(ISIP1, aes(x=temperature, y=value, colour = name, shape = Fe ))+
#geom_point(size = 2)+
#stat_summary(fun.y = mean, geom = "line", colour = "black", group =1, size = 1.25)+
#stat_summary(fun.data =  mean_se, geom = "errorbar", colour = "black")+
xlab ("Temperature (°C)")+
ylab ("Expression-Value")+
ggtitle("ISIP2A")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))+
theme(axis.text.x = element_text(angle = 50, vjust = 1.0, hjust = 1.0))+
guides(colour=FALSE)+
#scale_color_manual(name = "Treatment", labels = c("+Fe", "-Fe"), values = c("triangle", "square")) +
geom_jitter(width = 0.11, size =2)+
labs (shape = "Treatment")
#scale_y_log10()
#geom_line(aes(group=name))
```