---
title: "LJ_Frag_analysis"
author: "Loay Jabre"
output: html_document
editor_options: 
  chunk_output_type: console
---

Date Last Editted:    
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
#this displays the date this file was written 
Sys.time()
```

```{r message=FALSE, warning=FALSE, include=FALSE, results='hide'}
library(ggplot2)
library(dplyr)
library(plyr)
library(gplots)
library(heatmap.plus)
library(RColorBrewer)
library(dplyr)
library(reshape2)
library(scales)
library(calibrate)
library(tidyr)

#I have a R script in this W.D.  with all my functions, so all I do is call the functions from that R.Script into here
source("fragtranscript_functions.R")

```

need to figure out how to plot the top 10% or something liek that 
need to know how to plot specific ones 
Need to put proteins in groups depending on where they are in cells or organelles 
Figure out a way to plot things that show biggest change, regardless of what they are 

Analysis by ORF   
```{r message=FALSE, warning=FALSE, include=FALSE}
#Import dataset
ORF <- read.csv("ORF.csv", header = TRUE, sep = ",")

#removing unwanted columns
ORF1 <- ORF [-c(1:4, 6,7, 10:12, 15:21, 23:26, 28, 30:34, 35:46,50:58, 83:106)]

#Combine all names into one row 
ORF1$name <- paste(ORF1$kegg_desc, ORF1$KO_desc, ORF1$KO_pathway, ORF1$KOG_desc, ORF1$KOG_class, ORF1$best_hit_annotation, ORF1$PFams_desc, ORF1$TIGRFams_desc)

#delete the rows of the different names
ORF2 <- ORF1 [-c(1:8)]

#move the name column into the front of the dataset
ORF2 <- ORF2 [c(28, 1:27)]

#make all descriptions unique
ORF2$name <- sub('[.]', '_', make.names(ORF2$name, unique = TRUE))

#change column names to treatment names to make more sense 
 names(ORF2)<- c("name", "A_T0", "B_T0", "C_T0", "A_B12_0.5", "B_B12_0.5", "C_B12_0.5", "A_B12Fe_0.5", "B_B12Fe_0.5", "C_B12Fe_0.5", "A_0.5", "B_0.5", "C_0.5", "A_Fe_0.5", "B_Fe_0.5", "C_Fe_0.5", "A_3", "B_3", "C_3", "A_Fe_3", "B_Fe_3", "C_Fe_3","A_6", "B_6", "C_6", "A_Fe_6", "B_Fe_6", "C_Fe_6")
 
#ORFnoB12 <- ORF2 [-c(5:10)]
#ORFlowtemp <- ORF2 [-c(17:28)]
```


Flavodoxin
```{r echo=FALSE, message=FALSE, warning=FALSE}

#this creates a new dataframe from ORF2 only for flavodoxin. Don't really need this unless you want to look into the data. heatmpa does not use longformat data. 
flavodoxin <- dplyr::filter (ORF2, grepl('flavodoxin|Flavodoxin', name))

#this uses the heatmap function created in the functions file to plot heatmaps
heatmap(data, ORF2, 'flavodoxin')
heatmap_unclustered(data, ORF2, 'flavodoxin') 

#create long format from of flavodoxin to plot with ggplot. it 
flavodoxinmelt <-  melt (data = flavodoxin,id.vars = "name", measure.vars = c(2:28)) 

xyplot(flavodoxinmelt,"flavodoxin", 0.001)

```


HeatShock
```{r echo=FALSE, message=FALSE, warning=FALSE}

heatshock <- dplyr::filter (ORF2, grepl('HSP90', name))

heatmap_unclustered(iron, ORF2, 'PF00011')
heatmap(iron, ORF2, 'PF00011')
heatmap(iron, ORF2, 'HSP20')
```


Cold
```{r echo=FALSE, message=FALSE, warning=FALSE}
Antifreeze <- dplyr::filter (ORF2, grepl('cold.shock', name))
Antifreeze2 <- dplyr::filter (Antifreeze, grepl('X_', name))
antifreezemelt <- melt(data = Antifreeze2, id.vars = "name", measure.vars = c(2:25))

heatmap_unclustered(iron, ORF2, 'PF11999')
heatmap(iron, ORF2, 'PF11999')
heatmap_unclustered(iron, Antifreeze, 'X_')
heatmap(iron, Antifreeze, 'X_')
heatmap(ORF2, ORF2, 'Fba3')

xyplot (antifreezemelt, "Antifreeze")



```

Rubisco
```{r}

Rubisco <- dplyr::filter (ORF2, grepl('RBL', name))

heatmap_unclustered(ORF2, ORF2, 'RBL')
```

B12
```{r echo=FALSE, message=FALSE, warning=FALSE}
B12 <- dplyr::filter (ORF2, grepl('independent', name))

heatmap_unclustered(group, ORF2, 'METH|metH')
heatmap(iron, ORF2, 'METH|metH')
heatmap(iron, ORF2, 'Cobalamin.independent')

B12melt <-  melt (data = B12,id.vars = "name", measure.vars = c(2:28)) 

xyplot(B12melt, "B12", 0.001)
```

Nitrate/Nitrite
```{r echo=FALSE, message=FALSE, warning=FALSE}
Nitr <- dplyr::filter (ORF2, grepl('nitrate|Nitrate|nitrite|Nitrite', name))

heatmap(group, ORF2, 'NIR')

heatmap_unclustered(group, ORF2, 'NIR_2')

```

Photosystem_II
psbY : manganese binding protein of PSII
```{r echo=FALSE, message=FALSE, warning=FALSE}
heatmap(chloro, ORF2, 'Photosystem_II|photosystem_II|PSII|photosystemII')

heatmap(chloro, ORF2, 'PsbA')

heatmap(chloro, ORF2, 'PsbY')

heatmap(chloro, ORF2, 'PsbD')

heatmap(chloro, ORF2, 'PsbO')

heatmap(chloro, ORF2, 'CP47')

```

Cytochrome
```{r echo=FALSE, message=FALSE, warning=FALSE}
heatmap_unclustered(chloro, ORF2, 'b6f')
```

Photosystem_I
```{r echo=FALSE, message=FALSE, warning=FALSE}
heatmap(chloro, ORF2, 'PsaA')

heatmap(chloro, ORF2, 'PsaB')

heatmap(chloro, ORF2, 'PsaE')

heatmap(chloro, ORF2, 'CLPC')

```

ISIP
```{r echo=FALSE, message=FALSE, warning=FALSE}

heatmap(chloro, ORF2, 'ISIP')

heatmap(chloro, ORF2, 'ISIP1')

heatmap_unclustered(chloro, ORF2, 'ISIP1')

heatmap(chloro, ORF2, 'ISIP2')

heatmap_unclustered(chloro, ORF2, 'ISIP3')

heatmap(chloro, ORF2, 'ISIP3')


```

Pigments
```{r echo=FALSE, message=FALSE, warning=FALSE}

pigment <- dplyr::filter (ORF2, grepl('fucoxanthin', name))

heatmap_unclustered(chloro, ORF2, 'fucoxanthin')

heatmap(chloro, ORF2, 'fucoxanthin')

heatmap(chloro, pigment, 'Lhcf4')

heatmap_unclustered(chloro, pigment, 'Lhcf16')

heatmap_unclustered(chloro, pigment, 'Lhcx2')

```

























Erin's figure
```{r echo=FALSE, message=FALSE, warning=FALSE}
#MetE
MetE <- dplyr::filter (ORFerin, grepl('Cobalamin.independent', name))
heatmap_unclustered(chloro, MetE, 'Cobalamin.independent')
#heatmap(chloro, MetE, 'Cobalamin.independent')

MetEeditted <- MetE[-c(3,4,15),]

MetEeditted$name <- c("MetE_TIGR01371", "MetE", "MetE_TIGR01371_1","MetE_TIGR01371_2","MetE_1", "MetE_TIGR01371_3","MetE_TIGR01371_4", "MetE_2","MetE_3", "MetE_4",  "MetE_TIGR01371_5", "MetE_5" )


heatmap_unclustered(chloro, MetEeditted, 'Met')
heatmap(chloro, MetEeditted, 'Met')

```

```{r}
#CBA1
CBA1 <- dplyr::filter (ORFerin, grepl('CBA1', name))
heatmap_unclustered(chloro, CBA1, 'CBA1')
heatmap(chloro, CBA1, 'CBA1')

CBA1editted <- CBA1[-c(1,9,10),]

CBA1editted$name <- c("CBA1","CBA1_1","CBA1_2","CBA1_3","CBA1_4","CBA1_5","CBA1_6")

heatmap_unclustered(chloro, CBA1editted, 'CBA1')
heatmap(chloro, CBA1editted, 'CBA1')


```

```{r}

#ISIP2A
ISIP2A <- dplyr::filter (ORFerin, grepl('ISIP2', name))
ISIP2Aedit <- ISIP2A[-c(16,21,22,36:38,32,30),]

heatmap_unclustered(chloro, ISIP2A, 'ISIP2')
heatmap(chloro, ISIP2A, 'ISIP2')


heatmap_unclustered(chloro, ISIP2Aedit, 'ISIP2')
heatmap(chloro, ISIP2Aedit, 'ISIP2')
```

```{r}
#ISIP1A

ISIP1A <- dplyr::filter (ORFerin, grepl('ISIP1', name))
ISIP1A <- ISIP1A[-c(4,5,7,8,12,16,21,22,23,26),]
heatmap_unclustered(chloro, ORFerin, 'ISIP1')

heatmap_unclustered(chloro, ISIP1A, 'ISIP1')
heatmap(chloro, ISIP1A, 'ISIP1')
```

```{r}
CBAMet <- rbind (CBA1editted, MetEeditted)
CBAMet2 <- CBAMet [-c(2,3,4)]
heatmap_unclustered(chloro, CBAMet2, 'CBA1|Met')
heatmap(chloro, CBAMet2, 'CBA1|Met')

CBAmetISIP <- rbind(CBA1editted, MetEeditted, ISIP2Aedit)

heatmap_unclustered(chloro, CBAmetISIP, 'CBA1|Met|ISIP')
heatmap(chloro, CBAmetISIP, 'CBA1|Met|ISIP')

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
CBAmelt = melt(data = CBA1editted, id.vars = "name", measure.vars = c(2:16))

MetEmelt = melt (data = MetEeditted,id.vars = "name", measure.vars = c(2:16)) 

ggplot(MetEmelt, aes(x=variable, y=value ))+
  geom_point(aes(color = name))+
  geom_line(stat = "summary", fun.y = "mean")+
  xlab ("Treatmet")+
  ggtitle("CBA1")+
 theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 50, vjust = 1.0, hjust = 1.0))


ggplot(MetEmelt, aes(x=variable, y=value ))+
  geom_line(aes(color = name, group=name))+
  xlab ("Treatmet")+
  ggtitle("CBA1")+
 theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 50, vjust = 1.0, hjust = 1.0))

ggplot(CBAmelt, aes(x=variable, y=value ))+
  geom_line(aes(color = name, group=name))+
  xlab ("Treatmet")+
  ggtitle("CBA1")+
 theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text.x = element_text(angle = 50, vjust = 1.0, hjust = 1.0))
```





